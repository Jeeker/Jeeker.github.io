<!doctype html>
<!--[if lt IE 7 ]><html class="ie ie9below ie6"><![endif]-->
<!--[if IE 7 ]><html class="ie ie9below ie7"><![endif]-->
<!--[if IE 8 ]><html class="ie ie9below ie8"><![endif]-->
<!--[if IE 9 ]><html class="ie ie9"><![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html> <!--<![endif]-->
<head>
    <title>Jeeker</title>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" href="http://jeeker.net/assets/images/apple-touch-icon.png"/>
    <link rel="shortcut icon" type="image/x-icon" href="http://jeeker.net/assets/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="http://jeeker.net/assets/style.css?90737" />
    <link rel="alternate" type="application/atom+xml" href="http://jeeker.net/atom.xml" />
    <!-- <link rel='canonical' href="" /> -->
    <meta name="robots" content="index,follow" />
    <!-- <meta name="keywords" content="" /> -->
</head>
<body>

<div id="wrapper">
    <div id="gradient"></div><!-- #gradient -->
    <div id="header">
        <div id="menu">
            <ul>
                <li><a href="http://jeeker.net/"><span>Home</span></a></li>
                <li><a href="http://jeeker.net/projects/"><span>Projects</span></a></li>
                <li><a href="http://jeeker.net/tags/"><span>Tags</span></a></li>
                <li><a href="http://jeeker.net/archives/"><span>Archives</span></a></li>
                <li><a href="http://jeeker.net/atom.xml"><span>Feed</span></a></li>
                <li><a href="http://jeeker.net/about/"><span>About</span></a></li>
            </ul>
        </div>
    </div><!-- ＃header -->

<div id="main">
    <div id="tools-box">
        <ul>
            <li id="tool-search">
                <form action="http://google.com/search" method="get">
                    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
                    <input type="hidden" name="q" value="site:jeeker.net" />
                </form>
            </li>
        </ul>
    </div><!-- #tools-box -->

<div id="container">
    <div id="content" role="main">


<div id="post-29869" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/alfred-workflow-search-lyric/" title="Alfred Workflow: 歌词搜索" rel="bookmark">Alfred Workflow: 歌词搜索</a></h1>
        <p class="entry-date" title="2013-04-12 09:24:29">
            <span class="day">12</span>
            <span class="month">Apr</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　搜索歌词的<a href="http://www.alfredapp.com/">Alfred</a> Workflow，支持自动查找iTunes当前播放的歌曲或手动输入歌名查找，可将查到的歌词下载到本地或复制到剪切板或在Large Type显示，或直接保存到iTunes当前播放曲目中。</p>

<p><i><img src="http://7fvfpm.com1.z0.glb.clouddn.com/uploads/2013-04-12-alfred-workflow-search-lyric/screenshot.png" alt="Lyric Screenshot" /></i></p>

<p><span class="btn-group btn-center"><a href="https://github.com/JinnLynn/alfred-workflows/raw/master/bin/lyric.alfredworkflow" class="btn btn-large icon-download-alt">Download</a><a href="https://github.com/JinnLynn/alfred-workflows/tree/master/src/lyric" class="btn btn-large icon-github">Source</a></span></p>

<ul>
<li>ENTER 下载歌词到<code>~/Downloads</code></li>
<li>CMD + ENTER 拷贝歌词内容到剪切板</li>
<li>ALT + ENTER 在Large Type显示歌词并拷贝内容到剪切版</li>
<li>CTRL + ENTER 保存歌词到iTunes当前正在播放的歌曲</li>
</ul>

<p><strong>说明：除了下载歌词，其它歌词内容都是去除了时间线信息的</strong></p>

<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/developer/" title="View all posts in Developer" rel="category tag">Developer</a>
</li>
            <li class="entry-human-time-diff"> on Apr 12, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/alfred-workflow-search-lyric/#comments" title="Comment on Alfred Workflow: 歌词搜索">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-29869 -->
<div id="post-20269" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/alfred-2-workflow-chinese-dictionary/" title="Alfred 2 Workflow: 中文词典" rel="bookmark">Alfred 2 Workflow: 中文词典</a></h1>
        <p class="entry-date" title="2013-03-29 09:24:29">
            <span class="day">29</span>
            <span class="month">Mar</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　英文不咋地，还不要脸总爱浏览国外的网站，于是字典成了我最重要的工具之一，OS X的三指查词虽然很方便，可惜系统自带的Dictionary即使装了中文词典用着也总觉得不太爽，什么时态什么复数都直接被忽视，平时还是多用在线词典，有需求就要尝试去实现，研究了下<a href="http://www.alfredapp.com/">Alfred</a> V2无比强大的<a href="http://support.alfredapp.com/workflows">Workflow</a>，写了这个基于在线词典的中英互查工具。</p>

<p><i><img src="http://7fvfpm.com1.z0.glb.clouddn.com/uploads/2013-03-29-alfred-2-workflow-chinese-dictionary/screenshot.png" alt="Alfred 2 Chinese Dictionary" /></i></p>

<p><span class="btn-group btn-center"><a href="https://github.com/JinnLynn/alfred-workflows/raw/master/bin/chinese-dictionary.alfredworkflow" class="btn btn-large icon-download-alt">Download</a><a href="https://github.com/JinnLynn/alfred-workflows/tree/master/src/chinese-dictionary" class="btn btn-large icon-github">Source</a></span></p>

<p>　　安装什么的就不说了，使用很简单：</p>

<ul>
<li>关键词: <code>cd</code></li>
<li>ENTER 打开<a href="http://dict.qq.com">QQ词典</a>查词结果</li>
<li>CMD + ENTENT 拷贝单词到剪切板</li>
<li>CTRL + ENTER 打开<a href="http://iciba.com">爱词霸</a>查词结果</li>
<li>ALT + ENTER 发音，取决于系统安装的<a href="http://support.apple.com/kb/PH10841?viewlocale=zh_CN">Text to Speech</a>，建议使用Siri的Samantha，纯正美音</li>
</ul>

<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/developer/" title="View all posts in Developer" rel="category tag">Developer</a>
</li>
            <li class="entry-human-time-diff"> on Mar 29, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/alfred-2-workflow-chinese-dictionary/#comments" title="Comment on Alfred 2 Workflow: 中文词典">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-20269 -->
<div id="post-64180" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/first-arduino-experiment-show-amount-of-weibo-friend-new-status/" title="第一个Arduino实验: 新浪微博关注好友状态更新数量" rel="bookmark">第一个Arduino实验: 新浪微博关注好友状态更新数量</a></h1>
        <p class="entry-date" title="2013-03-20 15:23:00">
            <span class="day">20</span>
            <span class="month">Mar</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　一直想玩一玩电子设备，一般的单片机需要浪费太多时间在电子基础知识的学习上，不适合我这类人。</p>

<p>　　最后发现了<a href="http://arduino.cc/">Arduino</a>这个开源的硬件平台，社区活跃，对电子相关知识要求已是最低，于是订购了一个Arduino UNO的兼容版，上手挺容易，很快就折腾出了这个简单的小实验，功能是间隔三十秒获取新浪微博上好友状态更新数量并在数码管上显示。</p>

<h4 id="1-arduino">1. Arduino实验板连接</h4>

<p>　　实验板的连接不做详述，参考极客工坊的<a href="http://www.geek-workshop.com/thread-2038-1-1.html">这篇文章</a>，保证数码管引脚<code>E  D  C  DP B  A  F  G</code>分别对应Arduino数字输出2~9即可，Pin13做为电源输出。</p>

<h4 id="2">2. 程序源代码</h4>

<p>　　代码是Python2.7的，因此Arduino需预先写入<a href="http://firmata.org/">StandardFirmata</a>，而Python则需安装<a href="https://github.com/tino/pyFirmata">pyFirmata</a>模块。</p>

<div class="codehilite"><pre><code><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#! 强制默认编码为utf-8</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pyfirmata</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c">#! 微博的API调用需要OAuth2.0登陆授权</span>
<span class="c">#! 这里不做授权过程，需使用开发者账号测试 参考：http://t.cn/zYDjFan</span>
<span class="n">ACCESS_TOKEN</span> <span class="o">=</span> <span class="s">&#39;YOUR ACCESS TOKEN&#39;</span>

<span class="c"># Arduino硬件接口</span>
<span class="n">ARDUINO_PORT</span>        <span class="o">=</span> <span class="s">&#39;YOUR ARDUINO PORT&#39;</span>

<span class="n">POWER_PIN</span>           <span class="o">=</span> <span class="mi">13</span>
<span class="n">DOTPOINT_PIN</span>        <span class="o">=</span> <span class="mi">5</span>

<span class="n">NUMBERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c">#E  D  C  DP B  A  F  G   // 数码管</span>
    <span class="c">#2  3  4  5  6  7  8  9   // 输出端口</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="c"># 0</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="c"># 1</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c"># 2 </span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c"># 3</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c"># 4</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c"># 5</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c"># 6</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="c"># 7</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c"># 8</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c"># 9</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="c"># dot point</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c"># line</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c"># nothing</span>
<span class="p">]</span>

<span class="k">class</span> <span class="nc">WBftc</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arduino</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastStatusID</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initArduino</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arduino</span><span class="p">,</span> <span class="n">pyfirmata</span><span class="o">.</span><span class="n">Arduino</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">digital</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initArduino</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arduino</span><span class="p">,</span> <span class="n">pyfirmata</span><span class="o">.</span><span class="n">Arduino</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arduino</span> <span class="o">=</span> <span class="n">pyfirmata</span><span class="o">.</span><span class="n">Arduino</span><span class="p">(</span><span class="n">ARDUINO_PORT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">digital</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;init arduino fail.&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">outputArduino</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arduino</span><span class="p">,</span> <span class="n">pyfirmata</span><span class="o">.</span><span class="n">Arduino</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="c"># 输出 0 - 9 的数字</span>
        <span class="n">show</span> <span class="o">=</span> <span class="n">num</span>
        <span class="c"># 小于0 错误</span>
        <span class="k">if</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="c"># 大于 9 超出量程</span>
        <span class="k">elif</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
            <span class="n">show</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">digital</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">NUMBERS</span><span class="p">[</span><span class="n">show</span><span class="p">][</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">flashDotPoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">30</span><span class="p">):</span>
        <span class="n">show_dot</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arduino</span><span class="o">.</span><span class="n">digital</span><span class="p">[</span><span class="n">DOTPOINT_PIN</span><span class="p">]</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span> <span class="k">if</span> <span class="n">show_dot</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">show_dot</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">show_dot</span> <span class="k">else</span> <span class="bp">True</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetchWeiboStatusCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># -1 错误</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://api.weibo.com/2/statuses/friends_timeline/ids.json&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;access_token&#39;</span>  <span class="p">:</span> <span class="n">ACCESS_TOKEN</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastStatusID</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;since_id&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastStatusID</span> <span class="p">})</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">requst</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="s">&#39;{}?{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">requst</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;statuses&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;statuses&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statuses</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lastStatusID</span> <span class="o">=</span> <span class="n">statuses</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;something error.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">True</span><span class="p">):</span>
            <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetchWeiboStatusCount</span><span class="p">()</span>
            <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%H:%M:%S&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;{}: {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outputArduino</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flashDotPoint</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">WBftc</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r</span><span class="s">exit.&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">e</span>
</code></pre></div>

<p><span class="btn-single btn-center"><a href="https://gist.github.com/JinnLynn/5210753" class="btn btn-large icon-github">Source on gist</a></span></p>

<p>　　需配置<code>ACCESS_TOKEN</code>和<code>ARDUINO_PORT</code>。</p>

<p>　　<strong>NOTE</strong>: 访问微博API需要OAuth2.0授权，这里使用了开发者测试账户，详细请参考<a href="http://t.cn/zYDjFan">这篇文章</a>。</p>

<h4 id="3">3. 显示结果</h4>

<p>　　程序每隔30秒获取关注好友更新的微博数量并以以下方式显示：</p>

<ul>
<li>更新数量在0-9间，数码管正常显示</li>
<li>更新数量大于9，数码管显示『-』</li>
<li>出错，数码管不显示任何内容</li>
<li>小数点闪动</li>
</ul>

<p>　　同时，电脑终端也会打印相应的更新数量信息，<code>CTRL+C</code>退出程序。</p>

<p><center>
    <iframe class="user-box" height="445" width="720" src="http://player.youku.com/embed/XNTI5NjQ0NDA4" frameborder="0" allowfullscreen></iframe>
</center></p>

<p><a href="http://jeeker.net/article/first-arduino-experiment-show-amount-of-weibo-friend-new-status/#more-64180" class="more-link">Read more...</a></p>
<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
</li>
            <li class="entry-human-time-diff"> on Mar 20, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/first-arduino-experiment-show-amount-of-weibo-friend-new-status/#comments" title="Comment on 第一个Arduino实验: 新浪微博关注好友状态更新数量">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-64180 -->
<div id="post-81780" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/synology-nas-external-ip-change-notify/" title="Synology群晖NAS外部IP更新通知" rel="bookmark">Synology群晖NAS外部IP更新通知</a></h1>
        <p class="entry-date" title="2013-03-04 15:23:00">
            <span class="day">04</span>
            <span class="month">Mar</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　在我的群晖DS211j上使用DDNS服务时经常出现长时间无法正常更新IP的现象<sup class="footnote-ref" id="fnref-1"><a href="#fn-1">1</a></sup>，这对于需要经常从外部访问的我来说是个很大的问题，于是写了段Python<sup class="footnote-ref" id="fnref-2"><a href="#fn-2">2</a></sup>脚本在NAS上监控外部IP地址的变化，如果发现改变将发送新的IP地址到指定的邮箱。<sup class="footnote-ref" id="fnref-3"><a href="#fn-3">3</a></sup></p>

<h3 id="1">1. 脚本</h3>

<div class="codehilite"><pre><code><span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#! 强制默认编码为utf-8</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>

<span class="c"># 配置</span>
<span class="c"># SMTP服务器 用户 密码</span>
<span class="n">smtp_server</span> <span class="o">=</span> <span class="s">&#39;SMTP SERVER&#39;</span>
<span class="n">smtp_port</span>   <span class="o">=</span> <span class="mi">25</span>
<span class="n">smtp_usr</span>    <span class="o">=</span> <span class="s">&#39;SMTP USERNAME&#39;</span>
<span class="n">smtp_pwd</span>    <span class="o">=</span> <span class="s">&#39;SMTP PASSWORD&#39;</span>

<span class="c"># 发送接受邮箱地址</span>
<span class="c">#! 发送邮箱需是smtp_usr有权操作的邮箱</span>
<span class="n">from_addr</span>   <span class="o">=</span> <span class="s">&#39;FROM EMAIL ADDRESS&#39;</span>
<span class="n">to_addr</span>     <span class="o">=</span> <span class="s">&#39;TO EMAIL ADDRESS&#39;</span>

<span class="c"># 获取外网IP的网址 可以是</span>
<span class="c"># http://ifconfig.me/ip</span>
<span class="c"># http://ip.3322.net</span>
<span class="c"># http://members.3322.org/dyndns/getip</span>
<span class="n">ip_check_server</span> <span class="o">=</span> <span class="s">&#39;http://ip.3322.net&#39;</span>

<span class="c"># 记录文件路径</span>
<span class="n">log_file</span>    <span class="o">=</span> <span class="s">&#39;/tmp/ipcheck.log&#39;</span>

<span class="c"># 邮件主题 </span>
<span class="c"># 内容为新的IP</span>
<span class="n">mail_subject</span> <span class="o">=</span> <span class="s">&#39;IP check message&#39;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">smtplib</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">CheckIP</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openLog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveLog</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">openLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">log_file</span><span class="p">):</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;----</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
        <span class="c"># 确保第二行永远是分隔符</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;----</span><span class="se">\n</span><span class="s">&#39;</span>

    <span class="k">def</span> <span class="nf">saveLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">log_file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getOldIP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setNewIP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_ip</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">new_ip</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;{}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_ip</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sendMail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;from_addr&#39;</span> <span class="p">:</span> <span class="n">from_addr</span><span class="p">,</span>
                <span class="s">&#39;to_addr&#39;</span>   <span class="p">:</span> <span class="n">to_addr</span><span class="p">,</span>
                <span class="s">&#39;subject&#39;</span>   <span class="p">:</span> <span class="n">mail_subject</span><span class="p">,</span>
                <span class="s">&#39;msg&#39;</span>       <span class="p">:</span> <span class="n">msg</span> <span class="p">}</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;From: {from_addr}</span><span class="se">\r\n</span><span class="s">To: {to_addr}</span><span class="se">\r\n</span><span class="s">Subject: {subject}</span><span class="se">\r\n\r\n</span><span class="s">{msg}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">smtp</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">()</span>
            <span class="c"># smtp.set_debuglevel(1)</span>
            <span class="n">smtp</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">smtp_server</span><span class="p">,</span> <span class="n">smtp_port</span><span class="p">)</span>
            <span class="n">smtp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">smtp_usr</span><span class="p">,</span> <span class="n">smtp_pwd</span><span class="p">)</span>
            <span class="n">smtp</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">from_addr</span><span class="p">,</span> <span class="n">to_addr</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>   
            <span class="n">smtp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;send mail fail. {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">need_mail</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">log_msg</span> <span class="o">=</span> <span class="s">&#39;{}</span><span class="se">\t</span><span class="s">{}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span>
        <span class="c"># 检查最近的记录，如果相同仅更新时间</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">last_log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">last_log</span> <span class="o">==</span> <span class="n">msg</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_msg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">log_msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">log_msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">need_mail</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendMail</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">checkIP</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">old_ip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getOldIP</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">ip_check_server</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="n">new_ip</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s"> &#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;get ip fail. {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">old_ip</span> <span class="o">==</span> <span class="n">new_ip</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;IP unchanged.&#39;</span><span class="p">)</span>
        <span class="n">res</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendMail</span><span class="p">(</span><span class="s">&#39;IP Changed. {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_ip</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setNewIP</span><span class="p">(</span><span class="n">new_ip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;IP changed. {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">new_ip</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">cleanLog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkIP</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;--clean&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanLog</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;argument error.&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">ip</span> <span class="o">=</span> <span class="n">CheckIP</span><span class="p">()</span>
    <span class="n">ip</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p><span class="btn-single btn-center"><a href="https://gist.github.com/JinnLynn/5080616" class="btn btn-large icon-github">Source on gist</a></span></p>

<ul>
<li>将上述代码另存为文本，并按脚本中的注释正确设置SMTP服务器、账户、密码、发送及接收邮箱地址</li>
<li>将文件上传至NAS，如<code>/root/ipcheck.py</code></li>
<li>使用<em>root</em>账户登陆NAS将该文件权限设置为可执行<code>chmod 744 /root/ipcheck.py</code></li>
<li>执行<code>/root/ipcheck.py</code>测试，正常情况下你设置的接收邮箱将会收到一个包含NAS当前IP地址的邮件，如果没有请检查前面的操作是否正确。</li>
</ul>

<h3 id="2">2. 设定定时任务</h3>

<p>　　用<em>root</em>账户执行<code>vi /etc/crontab</code><sup class="footnote-ref" id="fnref-4"><a href="#fn-4">4</a></sup>，在打开的文件末尾添加如下内容：</p>

<pre><code>*/10        *        *        *        *        root        /root/ipcheck.py
</code></pre>

<p>　　其中<code>*/10</code>意为每10分钟检查一次外部IP。</p>

<p>　　最后执行命令重启cron</p>

<pre><code>/usr/syno/etc.defaults/rc.d/S04crond.sh stop &amp;&amp; sleep 1 &amp;&amp; /usr/syno/etc.defaults/rc.d/S04crond.sh start
</code></pre>

<p>　　至此，NAS将每隔一段时间检查外部IP，一旦发现地址变化就会发送邮件通知。</p>

<h3 id="3">3. 其它</h3>

<ul>
<li><code>/tmp/ipcheck.txt</code>为默认保存当前ip地址信息及日志的文件，每次检查ip地址时都跟此文件内容比较，如果不同则发送通知邮件</li>
</ul>

<p><strong>REF</strong>:</p>

<p>　　<a href="http://jeeker.net/article/apply-ssl-certificat-for-domain-from-startssl/">向StartSSL申请个人域名SSL证书</a></p>

<div class="footnotes">
<hr />
<ol>
<li id="fn-1">
<p>貌似这是群晖DDNS服务的通病，在DSM4.2已经允许设置多个DDNS服务，不过为以防万一，自行监控IP变化也不失为一个好的预防手段。&#160;<a href="#fnref-1" class="footnoteBackLink" title="Jump back to footnote 1 in the text.">&#8617;</a></p>
</li>

<li id="fn-2">
<p>群晖NAS DSM上默认不自带Python，需要从套件中心中安装。&#160;<a href="#fnref-2" class="footnoteBackLink" title="Jump back to footnote 2 in the text.">&#8617;</a></p>
</li>

<li id="fn-3">
<p>不仅仅只适用于群晖NAS，只要安装了Python的*nix系统均可正常使用。&#160;<a href="#fnref-3" class="footnoteBackLink" title="Jump back to footnote 3 in the text.">&#8617;</a></p>
</li>

<li id="fn-4">
<p>简单的vi操作: i进入编辑模式 esc 退出当前模式 : 进入命令行输入模式 w 保存内容 q 退出。&#160;<a href="#fnref-4" class="footnoteBackLink" title="Jump back to footnote 4 in the text.">&#8617;</a></p>
</li>
</ol>
</div>

<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
</li>
            <li class="entry-human-time-diff"> on Mar 04, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/synology-nas-external-ip-change-notify/#comments" title="Comment on Synology群晖NAS外部IP更新通知">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-81780 -->
<div id="post-73846" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/apply-ssl-certificat-for-domain-from-startssl/" title="向StartSSL申请个人域名SSL证书" rel="bookmark">向StartSSL申请个人域名SSL证书</a></h1>
        <p class="entry-date" title="2013-01-21 21:10:46">
            <span class="day">21</span>
            <span class="month">Jan</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　为方便在外时访问，NAS使用了DDNS服务并绑定了jeeker.net的一个子域名，同时启用了<a href="http://zh.wikipedia.org/wiki/HTTPS">HTTPS</a>连接以增强安全性，于是由于证书问题，每次访问NAS总出现烦人的警告。</p>

<p><i><img src="http://7fvfpm.com1.z0.glb.clouddn.com/uploads/2013-01-21-apply-ssl-certificat-for-domain-from-startssl/warn-page.png" alt="Chrome SSL Warning" /></i></p>

<p>　　解决这个问题的唯一方法当然就是安装一个有效的SSL证书，但向CA机构申请证书一年少者几十多者数千美元，很不划算，好在互联网上总不缺<a href="http://www.sslshopper.com/article-free-ssl-certificates-from-a-free-certificate-authority.html">免费午餐</a>，<a href="https://www.startssl.com/">StartSSL</a>就是很好的选择，下面就以它为例了解下SSL证书的申请和安装过程。</p>

<p><a href="http://jeeker.net/article/apply-ssl-certificat-for-domain-from-startssl/#more-73846" class="more-link">Read more...</a></p>
<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/misc/" title="View all posts in Misc" rel="category tag">Misc</a>
</li>
            <li class="entry-human-time-diff"> on Jan 21, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/apply-ssl-certificat-for-domain-from-startssl/#comments" title="Comment on 向StartSSL申请个人域名SSL证书">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-73846 -->


    <div id="pagenavi">
        <span class="pages">Page 2 of 7</span>
        <a href="http://jeeker.net/page/3/" class="nav-older">Older</a>
        <a href="http://jeeker.net/" class="nav-newer">Newer</a>
    </div><!-- #pagenavi -->
   
    </div><!-- #content -->
</div><!-- #container -->

<div id="sidebar">
</div><!-- #sidebar -->

</div><!-- #main -->

<div id="footer">
    <div id="footer-left">
        2012 Powered By <a href="http://jeeker.net/projects/gude/" title="a simple python static website generator">Gude</a>. Code licensed under <a href="http://opensource.org/licenses/MIT">MIT License</a>,
        articles licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
    </div><!-- #footer-left -->
    <div id="footer-right">
    </div><!-- #footer-right -->
</div><!-- #footer -->

</div><!-- #wrapper -->

<!-- print javascript -->
<script type="text/javascript" src="http://jeeker.net/assets/script/action.js?90737"></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='http://jeeker.net/assets/script/css3-mediaqueries.js?90737'></script>
<![endif]-->

<script type="text/javascript" src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=1635756822" charset="utf-8"></script>
<script type="text/javascript" src="/assets/additional.js"></script>

<!-- google analytics track code -->
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31118267-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

</body>
</html>