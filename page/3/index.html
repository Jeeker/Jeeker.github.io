<!doctype html>
<!--[if lt IE 7 ]><html class="ie ie9below ie6"><![endif]-->
<!--[if IE 7 ]><html class="ie ie9below ie7"><![endif]-->
<!--[if IE 8 ]><html class="ie ie9below ie8"><![endif]-->
<!--[if IE 9 ]><html class="ie ie9"><![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html> <!--<![endif]-->
<head>
    <title>Jeeker</title>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" href="http://jeeker.net/assets/images/apple-touch-icon.png"/>
    <link rel="shortcut icon" type="image/x-icon" href="http://jeeker.net/assets/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="http://jeeker.net/assets/style.css?88452" />
    <link rel="alternate" type="application/atom+xml" href="http://jeeker.net/atom.xml" />
    <!-- <link rel='canonical' href="" /> -->
    <meta name="robots" content="index,follow" />
    <!-- <meta name="keywords" content="" /> -->
</head>
<body>

<div id="wrapper">
    <div id="gradient"></div><!-- #gradient -->
    <div id="header">
        <div id="menu">
            <ul>
                <li><a href="http://jeeker.net/"><span>Home</span></a></li>
                <li><a href="http://jeeker.net/projects/"><span>Projects</span></a></li>
                <li><a href="http://jeeker.net/tags/"><span>Tags</span></a></li>
                <li><a href="http://jeeker.net/archives/"><span>Archives</span></a></li>
                <li><a href="http://jeeker.net/atom.xml"><span>Feed</span></a></li>
                <li><a href="http://jeeker.net/about/"><span>About</span></a></li>
            </ul>
        </div>
    </div><!-- ＃header -->

<div id="main">
    <div id="tools-box">
        <ul>
            <li id="tool-search">
                <form action="http://google.com/search" method="get">
                    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
                    <input type="hidden" name="q" value="site:jeeker.net" />
                </form>
            </li>
        </ul>
    </div><!-- #tools-box -->

<div id="container">
    <div id="content" role="main">


<div id="post-73846" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/apply-ssl-certificat-for-domain-from-startssl/" title="向StartSSL申请个人域名SSL证书" rel="bookmark">向StartSSL申请个人域名SSL证书</a></h1>
        <p class="entry-date" title="2013-01-21 21:10:46">
            <span class="day">21</span>
            <span class="month">Jan</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　为方便在外时访问，NAS使用了DDNS服务并绑定了jeeker.net的一个子域名，同时启用了<a href="http://zh.wikipedia.org/wiki/HTTPS">HTTPS</a>连接以增强安全性，于是由于证书问题，每次访问NAS总出现烦人的警告。</p>

<p><i><img src="http://7fvfpm.com1.z0.glb.clouddn.com/uploads/2013-01-21-apply-ssl-certificat-for-domain-from-startssl/warn-page.png" alt="Chrome SSL Warning" /></i></p>

<p>　　解决这个问题的唯一方法当然就是安装一个有效的SSL证书，但向CA机构申请证书一年少者几十多者数千美元，很不划算，好在互联网上总不缺<a href="http://www.sslshopper.com/article-free-ssl-certificates-from-a-free-certificate-authority.html">免费午餐</a>，<a href="https://www.startssl.com/">StartSSL</a>就是很好的选择，下面就以它为例了解下SSL证书的申请和安装过程。</p>

<p><a href="http://jeeker.net/article/apply-ssl-certificat-for-domain-from-startssl/#more-73846" class="more-link">Read more...</a></p>
<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/misc/" title="View all posts in Misc" rel="category tag">Misc</a>
</li>
            <li class="entry-human-time-diff"> on Jan 21, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/apply-ssl-certificat-for-domain-from-startssl/#comments" title="Comment on 向StartSSL申请个人域名SSL证书">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-73846 -->
<div id="post-42971" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/remote-control-synology-download-station/" title="命令行远程控制Synology DSM Download Station" rel="bookmark">命令行远程控制Synology DSM Download Station</a></h1>
        <p class="entry-date" title="2013-01-16 21:29:31">
            <span class="day">16</span>
            <span class="month">Jan</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　入手<a href="http://www.synology.com/">Synology DS211j</a>近两年，所有下载工作都是通过其自带的Download Station来完成，毫无疑问，DS的功能已经足够强大，不过每次添加任务都要先登陆DSM，总让我觉得有点麻烦，一直想通过本地终端直接控制DS，但始终不得其法。</p>

<p>　　直到这两天才发现其实从DSM 3.2开始DS就已经提供了官方API，看了下<a href="http://download.synology.com/download/other/Synology_Download_Station_Official_API_V3.pdf">文档</a>，接口如同常见的网络轮询服务，也不复杂，于是写了一段Python脚本，支持在终端查看、添加、暂停、恢复、清理下载任务以及禁用或启用eMule，基本能够满足日常应用了。</p>

<p>　　代码结构很简单，如何使用直接看源代码吧，不多废话了。</p>

<div class="codehilite"><pre><code><span class="c">#! /usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c">## </span>
<span class="c"># 使用Synology Download Station API远程控制文件下载</span>
<span class="c"># http://download.synology.com/download/other/Synology_Download_Station_Official_API_V3.pdf</span>
<span class="c"># Created by JinnLynn 2013.01.15 http://jeeker.net </span>
<span class="c">##</span>

<span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">urllib</span><span class="o">,</span> <span class="nn">urllib2</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="nb">reload</span><span class="p">(</span><span class="n">sys</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">setdefaultencoding</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>

<span class="c"># 设置: 网址 用户 密码</span>
<span class="n">NAS_URL</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">NAS_USR</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">NAS_PWD</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="n">CommonCodeDesc</span> <span class="o">=</span> <span class="p">{</span>  <span class="mi">100</span><span class="p">:</span> <span class="s">&#39;Unknown error&#39;</span><span class="p">,</span>
                    <span class="mi">101</span><span class="p">:</span> <span class="s">&#39;Invalid parameter&#39;</span><span class="p">,</span>
                    <span class="mi">102</span><span class="p">:</span> <span class="s">&#39;The requested API does not exist&#39;</span><span class="p">,</span>
                    <span class="mi">103</span><span class="p">:</span> <span class="s">&#39;The requested method does not exist&#39;</span><span class="p">,</span>
                    <span class="mi">104</span><span class="p">:</span> <span class="s">&#39;The requested version does not support the functionality&#39;</span><span class="p">,</span>
                    <span class="mi">105</span><span class="p">:</span> <span class="s">&#39;The logged in session does not have permission&#39;</span><span class="p">,</span>
                    <span class="mi">106</span><span class="p">:</span> <span class="s">&#39;Session timeout&#39;</span><span class="p">,</span>
                    <span class="mi">107</span><span class="p">:</span> <span class="s">&#39;Session interrupted by duplicate login&#39;</span>
                <span class="p">}</span>

<span class="n">AuthCodeDesc</span> <span class="o">=</span> <span class="p">{</span>    <span class="mi">400</span><span class="p">:</span> <span class="s">&#39;No such account or incorrect password&#39;</span><span class="p">,</span>
                    <span class="mi">401</span><span class="p">:</span> <span class="s">&#39;Guest account disabled&#39;</span><span class="p">,</span>
                    <span class="mi">402</span><span class="p">:</span> <span class="s">&#39;Account disabled&#39;</span><span class="p">,</span>
                    <span class="mi">403</span><span class="p">:</span> <span class="s">&#39;Wrong password&#39;</span><span class="p">,</span>
                    <span class="mi">404</span><span class="p">:</span> <span class="s">&#39;Permission denied&#39;</span>
                <span class="p">}</span>

<span class="n">DSTaskCodeDesc</span> <span class="o">=</span> <span class="p">{</span>  <span class="mi">400</span><span class="p">:</span> <span class="s">&#39;File upload failed&#39;</span><span class="p">,</span>
                    <span class="mi">401</span><span class="p">:</span> <span class="s">&#39;Max number of tasks reached&#39;</span><span class="p">,</span>
                    <span class="mi">402</span><span class="p">:</span> <span class="s">&#39;Destination denied&#39;</span><span class="p">,</span>
                    <span class="mi">403</span><span class="p">:</span> <span class="s">&#39;Destination does not exist&#39;</span><span class="p">,</span>
                    <span class="mi">404</span><span class="p">:</span> <span class="s">&#39;Invalid task id&#39;</span><span class="p">,</span>
                    <span class="mi">405</span><span class="p">:</span> <span class="s">&#39;Invalid task action&#39;</span>
                <span class="p">}</span>

<span class="n">DS_VERSION</span> <span class="o">=</span> <span class="s">&#39;0.1&#39;</span>

<span class="k">class</span> <span class="nc">DownloadStation</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sessionID</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debugInfo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cgipath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">subdir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;data error&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;_sid&#39;</span><span class="p">):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;_sid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessionID</span><span class="p">})</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">NAS_URL</span><span class="p">,</span> <span class="s">&#39;webapi&#39;</span><span class="p">,</span> <span class="n">subdir</span><span class="p">,</span> <span class="n">cgipath</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">requst</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">requst</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;error&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;code&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span><span class="s">&#39;success&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.API.Auth&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;login&#39;</span><span class="p">,</span>
                 <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                 <span class="s">&#39;account&#39;</span><span class="p">:</span> <span class="n">NAS_USR</span><span class="p">,</span>
                 <span class="s">&#39;passwd&#39;</span><span class="p">:</span>  <span class="n">NAS_PWD</span><span class="p">,</span>
                 <span class="s">&#39;session&#39;</span><span class="p">:</span> <span class="s">&#39;DownloadStation&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;auth.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sessionID</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;sid&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.API.Auth&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;logout&#39;</span><span class="p">,</span>
                 <span class="s">&#39;session&#39;</span><span class="p">:</span> <span class="s">&#39;DownloadStation&#39;</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;auth.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sessionID</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">tryLogin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessionID</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">login</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.DownloadStation.Info&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;getinfo&#39;</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/info.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="n">manager_info</span> <span class="o">=</span> <span class="s">&#39;, and you are manager.&#39;</span> <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;is_manager&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s">&#39;.&#39;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;everything is ok, the version of Download Station is {}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;version_string&#39;</span><span class="p">],</span> <span class="n">manager_info</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>


    <span class="c"># 显示当前下载速度</span>
    <span class="k">def</span> <span class="nf">showStatistic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.DownloadStation.Statistic&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;getinfo&#39;</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;statistic.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s">&#39;DownloadStation&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="n">speed_download</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;speed_download&#39;</span><span class="p">])</span>
        <span class="n">speed_upload</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;speed_upload&#39;</span><span class="p">])</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;{:15} download {:10} upload {:10}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;Speed:&#39;</span><span class="p">,</span> <span class="n">speed_download</span><span class="p">,</span> <span class="n">speed_upload</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;emule_speed_download&#39;</span><span class="p">):</span>
            <span class="n">emule_speed_download</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;emule_speed_download&#39;</span><span class="p">])</span>
            <span class="n">emule_speed_upload</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;emule_speed_upload&#39;</span><span class="p">])</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;{:15} download {:10} upload {:10}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;eMule Speed:&#39;</span><span class="p">,</span> <span class="n">emule_speed_download</span><span class="p">,</span> <span class="n">emule_speed_upload</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;eMule disabled.&#39;</span><span class="p">)</span>

    <span class="c"># 显示当前任务信息</span>
    <span class="k">def</span> <span class="nf">showTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simple</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">include_seeding</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">simple</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showStatistic</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>         <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>      <span class="s">&#39;list&#39;</span><span class="p">,</span>
                 <span class="s">&#39;additional&#39;</span><span class="p">:</span>  <span class="s">&#39;transfer&#39;</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">include_seeding</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;seeding&#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Task list is empty.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;{:10}{:15}{:10}{:15}{:15}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;Type&#39;</span><span class="p">,</span> <span class="s">&#39;Status&#39;</span><span class="p">,</span> <span class="s">&#39;Size&#39;</span><span class="p">,</span> <span class="s">&#39;Downloaded&#39;</span><span class="p">,</span> <span class="s">&#39;Speed&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">simple</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;{:40}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;Task ID&#39;</span><span class="p">,</span> <span class="s">&#39;Title&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">]:</span>
            <span class="n">task</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]);</span>
            <span class="n">task</span><span class="p">[</span><span class="s">&#39;add_size_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;additional&#39;</span><span class="p">][</span><span class="s">&#39;transfer&#39;</span><span class="p">][</span><span class="s">&#39;size_downloaded&#39;</span><span class="p">])</span>
            <span class="n">task</span><span class="p">[</span><span class="s">&#39;add_sued&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;additional&#39;</span><span class="p">][</span><span class="s">&#39;transfer&#39;</span><span class="p">][</span><span class="s">&#39;size_uploaded&#39;</span><span class="p">])</span>
            <span class="n">task</span><span class="p">[</span><span class="s">&#39;add_speed_d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;additional&#39;</span><span class="p">][</span><span class="s">&#39;transfer&#39;</span><span class="p">][</span><span class="s">&#39;speed_download&#39;</span><span class="p">])</span>
            <span class="n">task</span><span class="p">[</span><span class="s">&#39;add_su&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">humanSize</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;additional&#39;</span><span class="p">][</span><span class="s">&#39;transfer&#39;</span><span class="p">][</span><span class="s">&#39;speed_upload&#39;</span><span class="p">])</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;{type:10}{status:15}{size:10}{add_size_d:15}{add_speed_d:15}{title:30}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">task</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">simple</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;{id:40}{title}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">task</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="c"># 创建新的下载任务 参数可以是本地文件或链接</span>
    <span class="k">def</span> <span class="nf">createTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_or_file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link_or_file</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s">&#39;arguments error&#39;</span><span class="p">)</span>
        <span class="n">uris</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">link_or_file</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">link_or_file</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">link_or_file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">uris</span><span class="p">):</span>
                <span class="c"># 使用file参数似乎有问题 自己读</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">uris</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">uris</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> </span><span class="se">\t\r</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;create&#39;</span><span class="p">,</span>
                 <span class="s">&#39;uri&#39;</span><span class="p">:</span>     <span class="n">uris</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;task created.&#39;</span><span class="p">)</span>

    <span class="c"># 清理错误 及 已完成的任务</span>
    <span class="c">#! eMule任务中 有seeding状态的无法删除</span>
    <span class="k">def</span> <span class="nf">cleanTask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="c"># 获取任务列表</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>         <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>      <span class="s">&#39;list&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="n">need_clean</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">]:</span>
            <span class="c"># 错误 已完成 的清理</span>
            <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;error&#39;</span> <span class="ow">or</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;finished&#39;</span><span class="p">:</span>
                <span class="n">need_clean</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]:</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">need_clean</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;there is no task need to clean.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;delete&#39;</span><span class="p">,</span>
                 <span class="s">&#39;id&#39;</span><span class="p">:</span>      <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">need_clean</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]:</span>
            <span class="n">clean_res</span> <span class="o">=</span> <span class="s">&#39;clean success:&#39;</span> <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;clean fail(</span><span class="si">%d</span><span class="s">):&#39;</span> <span class="o">%</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">need_clean</span><span class="p">[</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]]</span> <span class="k">if</span> <span class="n">need_clean</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;{:20}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clean_res</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pauseTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="c"># 未自定id则暂停所有</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_id</span><span class="p">:</span>
            <span class="c"># 获取任务列表</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>         <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                     <span class="s">&#39;method&#39;</span><span class="p">:</span>      <span class="s">&#39;list&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">]:</span>
                <span class="c"># eMule做种的任务无法暂停</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;seeding&#39;</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s">&#39;there is no task can be paused.&#39;</span><span class="p">)</span>
            <span class="n">task_id</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="n">join</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span> <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span> <span class="s">&#39;pause&#39;</span><span class="p">,</span>
                 <span class="s">&#39;id&#39;</span><span class="p">:</span>      <span class="n">task_id</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;pause success:&#39;</span> <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;pause fail(</span><span class="si">%d</span><span class="s">):&#39;</span> <span class="o">%</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span> <span class="s">&#39;{:20}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">resumeTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="c"># 未自定id则恢复所有</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_id</span><span class="p">:</span>
            <span class="c"># 获取任务列表</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>         <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                     <span class="s">&#39;method&#39;</span><span class="p">:</span>      <span class="s">&#39;list&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
            <span class="n">ids</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;paused&#39;</span><span class="p">:</span>
                    <span class="n">ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s">&#39;there is no task can be paused.&#39;</span><span class="p">)</span>
            <span class="n">task_id</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span> <span class="o">.</span> <span class="n">join</span><span class="p">(</span><span class="n">ids</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;resume&#39;</span><span class="p">,</span>
                 <span class="s">&#39;id&#39;</span><span class="p">:</span>      <span class="n">task_id</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">]:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;resume success:&#39;</span> <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&#39;resume fail(</span><span class="si">%d</span><span class="s">):&#39;</span> <span class="o">%</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span>
            <span class="k">print</span><span class="p">(</span> <span class="s">&#39;{:20}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">deleteTask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tryLogin</span><span class="p">()</span>
        <span class="c"># 获取待删除任务信息</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;getinfo&#39;</span><span class="p">,</span>
                 <span class="s">&#39;id&#39;</span><span class="p">:</span>      <span class="n">task_id</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span><span class="s">&#39;task is non-existent.&#39;</span><span class="p">)</span>
        <span class="c"># 如果任务未完成 且 无错误 请求确认</span>
        <span class="n">need_confirm</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="s">&#39;tasks&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;error&#39;</span> <span class="ow">and</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;finished&#39;</span><span class="p">:</span>
                <span class="n">need_confirm</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">print</span><span class="p">(</span> <span class="s">&#39;{:20}{:40}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s">&#39;task uncompleted:&#39;</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">],</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">])</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">need_confirm</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&#39;are you sure to delete it(yes/no)?:&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;yes&#39;</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="c"># 删除</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>     <span class="s">&#39;SYNO.DownloadStation.Task&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>  <span class="s">&#39;delete&#39;</span><span class="p">,</span>
                 <span class="s">&#39;id&#39;</span><span class="p">:</span>      <span class="n">task_id</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/task.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;task deleted.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eMule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_enable</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;api&#39;</span><span class="p">:</span>             <span class="s">&#39;SYNO.DownloadStation.Info&#39;</span><span class="p">,</span>
                 <span class="s">&#39;method&#39;</span><span class="p">:</span>          <span class="s">&#39;setserverconfig&#39;</span><span class="p">,</span>
                 <span class="s">&#39;emule_enabled&#39;</span><span class="p">:</span>   <span class="s">&#39;false&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">is_enable</span> <span class="k">else</span> <span class="s">&#39;true&#39;</span>
        <span class="p">}</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">&#39;DownloadStation/info.cgi&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isSuccess</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">die</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;eMule was </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;enabled&#39;</span> <span class="k">if</span> <span class="n">is_enable</span> <span class="k">else</span> <span class="s">&#39;disabled&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">isSuccess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;success&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="o">=</span> <span class="s">&#39;something error&#39;</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;success&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastError</span> <span class="o">=</span> <span class="s">&#39;Fail. error code: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">][</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;something error&#39;</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">humanSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">byte</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">byte</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)):</span>
            <span class="n">byte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span> <span class="k">if</span> <span class="n">byte</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">byte</span> <span class="o">/</span> <span class="mf">1024.0</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="s">&#39;KB&#39;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="mf">1024.0</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s">&#39;MB&#39;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="mf">1024.0</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s">&#39;GB&#39;</span>
        <span class="k">return</span> <span class="s">&#39;{:.2f}{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">die</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">(</span><span class="n">prog</span> <span class="o">=</span> <span class="s">&#39;ds&#39;</span><span class="p">,</span> <span class="n">description</span> <span class="o">=</span> <span class="s">&#39;Synology NAS Download Station Tool.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="s">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%(prog)s</span><span class="s"> &#39;</span> <span class="o">+</span> <span class="n">DS_VERSION</span><span class="p">)</span>
    <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s">&#39;subcommands&#39;</span><span class="p">,</span> <span class="n">dest</span> <span class="o">=</span> <span class="s">&#39;sub_cmd&#39;</span><span class="p">)</span>

    <span class="c"># 任务信息</span>
    <span class="n">sub_info_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;show task infomation&#39;</span><span class="p">)</span>
    <span class="n">sub_info_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--simple&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;only show task id and title&#39;</span><span class="p">)</span>
    <span class="n">sub_info_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;--all&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;show all task&#39;</span><span class="p">)</span>

    <span class="c"># 创建新任务</span>
    <span class="n">sub_create_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">&#39;create&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;create new task&#39;</span><span class="p">)</span>
    <span class="n">sub_create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;link_or_file&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;single link or a file which include multi-links&#39;</span><span class="p">)</span>

    <span class="c"># 清理任务</span>
    <span class="n">sub_clean_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">&#39;clean&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;clean error or completed task&#39;</span><span class="p">)</span>

    <span class="c"># 暂停任务</span>
    <span class="n">sub_pause_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">&#39;pause&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;pause task&#39;</span><span class="p">)</span>
    <span class="n">sub_pause_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;task_id&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="c"># 恢复任务</span>
    <span class="n">sub_resume_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">&#39;resume&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;resume task&#39;</span><span class="p">)</span>
    <span class="n">sub_resume_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;task_id&#39;</span><span class="p">,</span> <span class="n">nargs</span> <span class="o">=</span> <span class="s">&#39;?&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">)</span>

    <span class="c"># 删除任务</span>
    <span class="n">sub_delete_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">&#39;delete&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;delete task&#39;</span><span class="p">)</span>
    <span class="n">sub_delete_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;task_id&#39;</span><span class="p">)</span>

    <span class="c"># eMule控制</span>
    <span class="n">sub_emule_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">&#39;emule&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;enable or disable eMule&#39;</span><span class="p">)</span>
    <span class="n">sub_emule_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;operate&#39;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;on&#39;</span><span class="p">,</span> <span class="s">&#39;off&#39;</span><span class="p">])</span>

    <span class="c"># 测试</span>
    <span class="n">sub_test_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="n">help</span> <span class="o">=</span> <span class="s">&#39;test API&#39;</span><span class="p">)</span>

    <span class="c"># 如果没有参数则默认输出info</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s">&#39;info&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">cmd_map</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;info&#39;</span><span class="p">:</span>     <span class="k">lambda</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">showTask</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">simple</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">all</span><span class="p">),</span>
                <span class="s">&#39;create&#39;</span><span class="p">:</span>   <span class="k">lambda</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">createTask</span><span class="p">(</span> <span class="n">args</span><span class="o">.</span><span class="n">link_or_file</span> <span class="p">),</span>
                <span class="s">&#39;clean&#39;</span><span class="p">:</span>    <span class="k">lambda</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">cleanTask</span><span class="p">(),</span>
                <span class="s">&#39;pause&#39;</span><span class="p">:</span>    <span class="k">lambda</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">pauseTask</span><span class="p">(</span> <span class="n">args</span><span class="o">.</span><span class="n">task_id</span> <span class="p">),</span>
                <span class="s">&#39;resume&#39;</span><span class="p">:</span>   <span class="k">lambda</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">resumeTask</span><span class="p">(</span> <span class="n">args</span><span class="o">.</span><span class="n">task_id</span> <span class="p">),</span>
                <span class="s">&#39;delete&#39;</span><span class="p">:</span>   <span class="k">lambda</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">deleteTask</span><span class="p">(</span> <span class="n">args</span><span class="o">.</span><span class="n">task_id</span> <span class="p">),</span>
                <span class="s">&#39;emule&#39;</span><span class="p">:</span>    <span class="k">lambda</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">eMule</span><span class="p">(</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">operate</span> <span class="o">==</span> <span class="s">&#39;on&#39;</span> <span class="k">else</span> <span class="bp">False</span><span class="p">),</span>
                <span class="s">&#39;test&#39;</span><span class="p">:</span>     <span class="k">lambda</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">cmd_map</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">sub_cmd</span><span class="p">):</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">DownloadStation</span><span class="p">()</span>
        <span class="n">cmd_map</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">sub_cmd</span><span class="p">]()</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;something error.&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>

<p><span class="btn-single btn-center"><a href="https://github.com/JinnLynn/MacOSX-Kits/blob/master/Python/ds" class="btn btn-large icon-github">Source on GitHub</a></span></p>

<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/developer/" title="View all posts in Developer" rel="category tag">Developer</a>
</li>
            <li class="entry-human-time-diff"> on Jan 16, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/remote-control-synology-download-station/#comments" title="Comment on 命令行远程控制Synology DSM Download Station">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-42971 -->
<div id="post-45453" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/export-wordpress-to-sina-blog/" title="导出Wordpress日志到新浪博客" rel="bookmark">导出Wordpress日志到新浪博客</a></h1>
        <p class="entry-date" title="2013-01-13 10:50:53">
            <span class="day">13</span>
            <span class="month">Jan</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　服务器即将到期，不想再续租，<a href="http://jeeker.net/projects/gude/">自己的博客已经转成静态的了</a>，放到<a href="http://pages.github.com/">GitHub Pages</a>上当然是最好的选择， 服务器上另一个<a href="http://wendy.jeeker.net/">朋友的博客</a>打算入住新浪博客， 于是就涉及到怎么迁移数据的问题了， 好在新浪博客还算比较开放，支持<a href="http://xmlrpc.scripting.com/metaWeblogApi.html">MetaWeblog XML-RPC API</a>，写了一段简单的脚本，搬家成功。</p>

<p>　　不过新浪博客的API貌似不支持<code>dateCreated</code>，因此导入后所有日志的发布时间都变成当前时间了，另外脚本也没有对日志分类进行处理，好在日志不多，手动调整也不是那么麻烦。</p>

<div class="codehilite"><pre><code><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * 导出Wordpress日志到新浪博客</span>
<span class="sd"> * Created by JinnLynn 2013.01.11 http://jeeker.net/</span>
<span class="sd"> */</span>
<span class="k">require</span><span class="p">(</span><span class="s1">&#39;./wp-blog-header.php&#39;</span><span class="p">);</span>
<span class="k">require</span><span class="p">(</span><span class="s1">&#39;wp-includes/class-IXR.php&#39;</span><span class="p">);</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;SINA_XMLRPC&#39;</span><span class="p">,</span> <span class="s1">&#39;http://upload.move.blog.sina.com.cn/blog_rebuild/blog/xmlrpc.php&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;br /&gt;</span>
<span class="x">&lt;form action=&quot;?action=1&quot; method=&quot;post&quot;&gt;</span>
<span class="x">    新浪账户: &lt;input type=&quot;text&quot; name=&quot;usr&quot; value=&quot;&quot; /&gt;&lt;br /&gt;</span>
<span class="x">    新浪密码: &lt;input type=&quot;password&quot; name=&quot;pwd&quot; value=&quot;&quot; /&gt;&lt;br /&gt;</span>
<span class="x">    &lt;input type=&quot;submit&quot; value=&quot;导出&quot; /&gt;&lt;br /&gt;</span>
<span class="x">&lt;/form&gt;&lt;br /&gt;</span>
<span class="x">导出前请确认已开通了新浪博客，并设置了正确的账户密码。</span>
<span class="cp">&lt;?php</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$usr</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;usr&#39;</span><span class="p">]);</span>
<span class="nv">$pwd</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;pwd&#39;</span><span class="p">]);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$usr</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$pwd</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;&lt;br /&gt;&lt;span style=&quot;color:red;&quot;&gt;用户名或密码错误。&lt;/span&gt;&lt;a href=&quot;javascript:history.back()&quot;&gt;back&lt;/a&gt;.&#39;</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 登陆测试</span>
<span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$usr</span><span class="p">,</span> <span class="nv">$pwd</span><span class="p">);</span>
<span class="nv">$sina_xmlrpc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IXR_Client</span><span class="p">(</span><span class="nx">SINA_XMLRPC</span><span class="p">);</span>
<span class="nv">$sina_xmlrpc</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;metaWeblog.getCategories&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
<span class="nv">$res</span> <span class="o">=</span> <span class="nv">$sina_xmlrpc</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$sina_xmlrpc</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;faultCode&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;&lt;br /&gt;&lt;span style=&quot;color:red;&quot;&gt;用户名或密码错误。&lt;/span&gt;&lt;a href=&quot;javascript:history.back()&quot;&gt;back&lt;/a&gt;.&#39;</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WP_Query</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;post_type&#39;</span>       <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">),</span> <span class="c1">// 导出类型</span>
                      <span class="s1">&#39;order&#39;</span>           <span class="o">=&gt;</span> <span class="s1">&#39;ASC&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;posts_per_page&#39;</span>  <span class="o">=&gt;</span> <span class="mi">10000</span> <span class="p">)</span>
              <span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">have_posts</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$post</span><span class="p">;</span>

    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">the_post</span><span class="p">();</span>

    <span class="nv">$layout</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_type</span><span class="p">;</span>
    <span class="nv">$title</span> <span class="o">=</span> <span class="nx">get_the_title</span><span class="p">();</span>
    <span class="nv">$date</span> <span class="o">=</span> <span class="nx">get_post_time</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:m:s&#39;</span><span class="p">);</span>
    <span class="nv">$author</span> <span class="o">=</span> <span class="nx">get_the_author</span><span class="p">();</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">;</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">apply_filters</span><span class="p">(</span><span class="s1">&#39;the_content&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;]]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;]]&gt;&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

    <span class="nv">$content</span> <span class="o">.=</span> <span class="s1">&#39;&lt;p id=&quot;original-post-date&quot; style=&quot;color:#ccc&quot;&gt;&lt;br /&gt;-----&lt;br /&gt;原文发表于：&#39;</span><span class="o">.</span> <span class="nv">$date</span> <span class="o">.</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span><span class="p">;</span>

    <span class="nv">$sina_post</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;title&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$title</span><span class="p">,</span>
                        <span class="s1">&#39;dateCreated&#39;</span> <span class="o">=&gt;</span> <span class="nx">get_post_time</span><span class="p">(</span><span class="s1">&#39;Y-m-d\TH:m:s\Z&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">//!? 没有作用</span>
                        <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nv">$content</span><span class="p">);</span>

    <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$usr</span><span class="p">,</span> <span class="nv">$pwd</span><span class="p">,</span> <span class="nv">$sina_post</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

    <span class="nv">$sina_xmlrpc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IXR_Client</span><span class="p">(</span><span class="nx">SINA_XMLRPC</span><span class="p">);</span>
    <span class="nv">$sina_xmlrpc</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;metaWeblog.newPost&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$sina_xmlrpc</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>

    <span class="nb">unset</span><span class="p">(</span><span class="nv">$sina_xmlrpc</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;faultCode&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="s1">&#39;&lt;span style=&quot;color:red;&quot;&gt;导出失败&lt;/span&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">echo</span> <span class="nv">$title</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=&gt; &#39;</span> <span class="o">.</span> <span class="nv">$res</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&lt;br /&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>

<p><span class="btn-single btn-center"><a href="https://gist.github.com/4518491" class="btn btn-large icon-github">Source on gist</a></span></p>

<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/developer/" title="View all posts in Developer" rel="category tag">Developer</a>
</li>
            <li class="entry-human-time-diff"> on Jan 13, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/export-wordpress-to-sina-blog/#comments" title="Comment on 导出Wordpress日志到新浪博客">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-45453 -->
<div id="post-81391" class="post post-list post-page post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/projects/gude/" title="Gude" rel="bookmark">Gude</a></h1>
        <p class="entry-date" title="2013-01-10 09:29:51">
            <span class="day">10</span>
            <span class="month">Jan</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　厌倦了<a href="http://wordpress.org/">Wordpress</a>越来越庞杂却无用的功能，想让网站回归单纯，<a href="http://octopress.org/">Octopress</a>本是个不错的选择，但在OS X下总有这样那样的问题，自己对Ruby也不了解，于是就在Python下折腾出了这个Gude。</p>

<p>　　如下图，在Gude下网站日常管理的几个简单命令。</p>

<p><i><img src="http://7fvfpm.com1.z0.glb.clouddn.com/uploads/projects/2013-01-10-gude/workflow.png" alt="Gude" /></i></p>

<ul>
<li>基于Python2.7</li>
<li>使用GIT进行管理和发布</li>
<li>使用Markdown或HTML撰写文章</li>
<li>支持分类、标签</li>
<li>支持文章模板、站点皮肤</li>
<li>评论系统Disgus，统计系统Google Analytucs</li>
<li>支持发布到Github或任意的FTP服务器<sup class="footnote-ref" id="fnref-1"><a href="#fn-1">1</a></sup></li>
<li>简单的插件支持</li>
</ul>

<p><span class="btn-single btn-center"><a href="https://github.com/JinnLynn/gude" class="btn btn-large icon-github">Project on GitHub</a></span></p>

<div class="footnotes">
<hr />
<ol>
<li id="fn-1">
<p>FTP发布需<a href="https://github.com/resmo/git-ftp">GIT-FTP</a>支持&#160;<a href="#fnref-1" class="footnoteBackLink" title="Jump back to footnote 1 in the text.">&#8617;</a></p>
</li>
</ol>
</div>

<p><a href="http://jeeker.net/projects/gude/#more-81391" class="more-link">Read more...</a></p>
<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/projects/" title="View all posts in Projects" rel="category tag">Projects</a>
</li>
            <li class="entry-human-time-diff"> on Jan 10, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/projects/gude/#comments" title="Comment on Gude">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-81391 -->
<div id="post-67562" class="post post-list post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/google-search-url-uncover/" title="一个超简单的在Google中直接访问目标网址的脚本" rel="bookmark">一个超简单的在Google中直接访问目标网址的脚本</a></h1>
        <p class="entry-date" title="2012-11-22 14:59:22">
            <span class="day">22</span>
            <span class="month">Nov</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　前段时间因开某会，悲催的Google一如以往的无法正常使用，常常搜索结果页面顺利出现了，点击链接却无法打开或打开很慢，产生这种现象的原因是Google通过跳转后才把目标网址返回给你，于是领导一个不高兴就又被墙了。</p>

<p>　　下面的这段很简单的代码就是让你避免使用Google跳转，直接访问目标网址。</p>

<div class="codehilite"><pre><code><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">function</span> <span class="nx">getRealUrl</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;/url?&#39;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span> 
        <span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span>
        <span class="nx">seg</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">search</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\?/</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">seg</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> 
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nx">seg</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">);</span> 
            <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;url&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">decodeURIComponent</span><span class="p">(</span> <span class="nx">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">);</span>
        <span class="p">}</span> 
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 直接在载入http:://www.google.com/url?.... 中重定向到真实的目标网址</span>
<span class="cm">     * 问题：当目标网址无法访问时，地址栏中的地址信息并未改变到目标网址，可能产生误解</span>
<span class="cm">     */</span>
    <span class="kd">var</span> <span class="nx">real</span> <span class="o">=</span> <span class="nx">getRealUrl</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">real</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">real</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span> <span class="nx">a</span><span class="p">;</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">localName</span> <span class="o">!=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> 
                <span class="k">continue</span><span class="p">;</span>
            <span class="nx">real</span> <span class="o">=</span> <span class="nx">getRealUrl</span><span class="p">(</span> <span class="nx">a</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span> <span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">real</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">a</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span> <span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="nx">real</span> <span class="p">);</span>
                <span class="nx">a</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="s1">&#39;onmousedown&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="p">})();</span>
</code></pre></div>

<p><span class="btn-single btn-center"><a href="https://gist.github.com/4507194" class="btn btn-large icon-github">Source on gist</a></span></p>

<p>你可以通过三种方法使用：</p>

<h5 id="1-chrome">1. 通过Chrome扩展</h5>

<p>　　将url.js、manifest.json通过Chrome扩展开发工具打包成crx包。</p>

<h5 id="2">2. 通过收藏栏链接</h5>

<p>　　将下面的链接拖到浏览器收藏栏中，需要时点击即可，在Chrome、Firefox中可用，Safari中似乎直接访问的就是目标地址了</p>

<p><span class="btn-center">
    <a class="btn btn-large icon-bookmark-empty" href="javascript:(function(){function getRealUrl(l){if(l.indexOf("/url?')&lt;0)return null;var a=document.createElement('a');a.href=l;seg=a.search.replace(/^\?/,'').split('&amp;');for(i=0;i<seg.length;i++){if(!seg[i])continue;s=seg[i].split('=');if(s[0]=='url')return decodeURIComponent(s[1]);}return null;}var real=getRealUrl(location.href);if(real){window.location.href=real;return;};document.addEventListener('click',function(e){for(a=e.target;a;a=a.parentNode){if(a.localName!='a')continue;real=getRealUrl(a.getAttribute('href'));if(real){alert('d');a.setAttribute('href',real);a.removeAttribute('onmousedown');}break;}},false);})();">Google Search URL Uncover</a>
</span></p>

<h5 id="3-userscript">3. 通过用户脚本（UserScript）</h5>

<p>　　未测试过，不过理论上应该可行。在脚本前添加如下内容</p>

<div class="codehilite"><pre><code><span class="c1">// ==UserScript==</span>
<span class="c1">// @name           Google URL Uncover</span>
<span class="c1">// @namespace      http://jeeker.net/article/google-search-url-uncover/</span>
<span class="c1">// @description    Google 搜索结果链接去除google跳转，直接访问目标网址。</span>
<span class="c1">// @include        http://*.google.*/*</span>
<span class="c1">// @include        https://*.google.*/*</span>
<span class="c1">// @version        0.1</span>
<span class="c1">// @author         JinnLynn</span>
<span class="c1">// @license        MIT license</span>
<span class="c1">// ==/UserScript==</span>
</code></pre></div>

<p><strong>PS:</strong> 代码在Chrome下测试通过，IE没戏。</p>

<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/developer/" title="View all posts in Developer" rel="category tag">Developer</a>
</li>
            <li class="entry-human-time-diff"> on Nov 22, 2012</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/google-search-url-uncover/#comments" title="Comment on 一个超简单的在Google中直接访问目标网址的脚本">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-67562 -->


    <div id="pagenavi">
        <span class="pages">Page 3 of 7</span>
        <a href="http://jeeker.net/page/4/" class="nav-older">Older</a>
        <a href="http://jeeker.net/page/2/" class="nav-newer">Newer</a>
    </div><!-- #pagenavi -->
   
    </div><!-- #content -->
</div><!-- #container -->

<div id="sidebar">
</div><!-- #sidebar -->

</div><!-- #main -->

<div id="footer">
    <div id="footer-left">
        2012 Powered By <a href="http://jeeker.net/projects/gude/" title="a simple python static website generator">Gude</a>. Code licensed under <a href="http://opensource.org/licenses/MIT">MIT License</a>,
        articles licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
    </div><!-- #footer-left -->
    <div id="footer-right">
    </div><!-- #footer-right -->
</div><!-- #footer -->

</div><!-- #wrapper -->

<!-- print javascript -->
<script type="text/javascript" src="http://jeeker.net/assets/script/action.js?88452"></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='http://jeeker.net/assets/script/css3-mediaqueries.js?88452'></script>
<![endif]-->

<script type="text/javascript" src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=1635756822" charset="utf-8"></script>
<script type="text/javascript" src="/assets/additional.js"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?11f04d253f26f8e70f1701a6920da168";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- google analytics track code -->
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31118267-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

</body>
</html>