<!doctype html>
<!--[if lt IE 7 ]><html class="ie ie9below ie6"><![endif]-->
<!--[if IE 7 ]><html class="ie ie9below ie7"><![endif]-->
<!--[if IE 8 ]><html class="ie ie9below ie8"><![endif]-->
<!--[if IE 9 ]><html class="ie ie9"><![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html> <!--<![endif]-->
<head>
    <title>新浪博客 - Jeeker</title>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" href="http://jeeker.net/assets/images/apple-touch-icon.png"/>
    <link rel="shortcut icon" type="image/x-icon" href="http://jeeker.net/assets/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="http://jeeker.net/assets/style.css?90737" />
    <link rel="alternate" type="application/atom+xml" href="http://jeeker.net/atom.xml" />
    <!-- <link rel='canonical' href="" /> -->
    <meta name="robots" content="index,follow" />
    <!-- <meta name="keywords" content="" /> -->
</head>
<body>

<div id="wrapper">
    <div id="gradient"></div><!-- #gradient -->
    <div id="header">
        <div id="menu">
            <ul>
                <li><a href="http://jeeker.net/"><span>Home</span></a></li>
                <li><a href="http://jeeker.net/projects/"><span>Projects</span></a></li>
                <li><a href="http://jeeker.net/tags/"><span>Tags</span></a></li>
                <li><a href="http://jeeker.net/archives/"><span>Archives</span></a></li>
                <li><a href="http://jeeker.net/atom.xml"><span>Feed</span></a></li>
                <li><a href="http://jeeker.net/about/"><span>About</span></a></li>
            </ul>
        </div>
    </div><!-- ＃header -->

<div id="main">
    <div id="tools-box">
        <ul>
            <li id="tool-search">
                <form action="http://google.com/search" method="get">
                    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
                    <input type="hidden" name="q" value="site:jeeker.net" />
                </form>
            </li>
        </ul>
    </div><!-- #tools-box -->

<div id="container">
    <div id="content" role="main">



<div id="post-45453" class="post-list post post-post post-publish">
    <div class="entry-head">
        <h1><a href="http://jeeker.net/article/export-wordpress-to-sina-blog/" title="导出Wordpress日志到新浪博客" rel="bookmark">导出Wordpress日志到新浪博客</a></h1>
        <p class="entry-date" title="2013-01-13 10:50:53">
            <span class="day">13</span>
            <span class="month">Jan</span>
        </p>
    </div><!-- .entry-header -->
    <div class="entry-content">
<!-- content start -->
<p>　　服务器即将到期，不想再续租，<a href="http://jeeker.net/projects/gude/">自己的博客已经转成静态的了</a>，放到<a href="http://pages.github.com/">GitHub Pages</a>上当然是最好的选择， 服务器上另一个<a href="http://wendy.jeeker.net/">朋友的博客</a>打算入住新浪博客， 于是就涉及到怎么迁移数据的问题了， 好在新浪博客还算比较开放，支持<a href="http://xmlrpc.scripting.com/metaWeblogApi.html">MetaWeblog XML-RPC API</a>，写了一段简单的脚本，搬家成功。</p>

<p>　　不过新浪博客的API貌似不支持<code>dateCreated</code>，因此导入后所有日志的发布时间都变成当前时间了，另外脚本也没有对日志分类进行处理，好在日志不多，手动调整也不是那么麻烦。</p>

<div class="codehilite"><pre><code><span class="cp">&lt;?php</span>
<span class="sd">/**</span>
<span class="sd"> * 导出Wordpress日志到新浪博客</span>
<span class="sd"> * Created by JinnLynn 2013.01.11 http://jeeker.net/</span>
<span class="sd"> */</span>
<span class="k">require</span><span class="p">(</span><span class="s1">&#39;./wp-blog-header.php&#39;</span><span class="p">);</span>
<span class="k">require</span><span class="p">(</span><span class="s1">&#39;wp-includes/class-IXR.php&#39;</span><span class="p">);</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;SINA_XMLRPC&#39;</span><span class="p">,</span> <span class="s1">&#39;http://upload.move.blog.sina.com.cn/blog_rebuild/blog/xmlrpc.php&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">?&gt;</span><span class="x"></span>
<span class="x">&lt;br /&gt;</span>
<span class="x">&lt;form action=&quot;?action=1&quot; method=&quot;post&quot;&gt;</span>
<span class="x">    新浪账户: &lt;input type=&quot;text&quot; name=&quot;usr&quot; value=&quot;&quot; /&gt;&lt;br /&gt;</span>
<span class="x">    新浪密码: &lt;input type=&quot;password&quot; name=&quot;pwd&quot; value=&quot;&quot; /&gt;&lt;br /&gt;</span>
<span class="x">    &lt;input type=&quot;submit&quot; value=&quot;导出&quot; /&gt;&lt;br /&gt;</span>
<span class="x">&lt;/form&gt;&lt;br /&gt;</span>
<span class="x">导出前请确认已开通了新浪博客，并设置了正确的账户密码。</span>
<span class="cp">&lt;?php</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$usr</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;usr&#39;</span><span class="p">]);</span>
<span class="nv">$pwd</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;pwd&#39;</span><span class="p">]);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$usr</span><span class="p">)</span> <span class="o">||</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$pwd</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;&lt;br /&gt;&lt;span style=&quot;color:red;&quot;&gt;用户名或密码错误。&lt;/span&gt;&lt;a href=&quot;javascript:history.back()&quot;&gt;back&lt;/a&gt;.&#39;</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 登陆测试</span>
<span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$usr</span><span class="p">,</span> <span class="nv">$pwd</span><span class="p">);</span>
<span class="nv">$sina_xmlrpc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IXR_Client</span><span class="p">(</span><span class="nx">SINA_XMLRPC</span><span class="p">);</span>
<span class="nv">$sina_xmlrpc</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;metaWeblog.getCategories&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
<span class="nv">$res</span> <span class="o">=</span> <span class="nv">$sina_xmlrpc</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$sina_xmlrpc</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;faultCode&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;&lt;br /&gt;&lt;span style=&quot;color:red;&quot;&gt;用户名或密码错误。&lt;/span&gt;&lt;a href=&quot;javascript:history.back()&quot;&gt;back&lt;/a&gt;.&#39;</span><span class="p">;</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WP_Query</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;post_type&#39;</span>       <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;page&#39;</span><span class="p">),</span> <span class="c1">// 导出类型</span>
                      <span class="s1">&#39;order&#39;</span>           <span class="o">=&gt;</span> <span class="s1">&#39;ASC&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;posts_per_page&#39;</span>  <span class="o">=&gt;</span> <span class="mi">10000</span> <span class="p">)</span>
              <span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">have_posts</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$post</span><span class="p">;</span>

    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">the_post</span><span class="p">();</span>

    <span class="nv">$layout</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_type</span><span class="p">;</span>
    <span class="nv">$title</span> <span class="o">=</span> <span class="nx">get_the_title</span><span class="p">();</span>
    <span class="nv">$date</span> <span class="o">=</span> <span class="nx">get_post_time</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:m:s&#39;</span><span class="p">);</span>
    <span class="nv">$author</span> <span class="o">=</span> <span class="nx">get_the_author</span><span class="p">();</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">post_content</span><span class="p">;</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nx">apply_filters</span><span class="p">(</span><span class="s1">&#39;the_content&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>
    <span class="nv">$content</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;]]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;]]&gt;&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

    <span class="nv">$content</span> <span class="o">.=</span> <span class="s1">&#39;&lt;p id=&quot;original-post-date&quot; style=&quot;color:#ccc&quot;&gt;&lt;br /&gt;-----&lt;br /&gt;原文发表于：&#39;</span><span class="o">.</span> <span class="nv">$date</span> <span class="o">.</span> <span class="s1">&#39;&lt;/p&gt;&#39;</span><span class="p">;</span>

    <span class="nv">$sina_post</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="s1">&#39;title&#39;</span>       <span class="o">=&gt;</span> <span class="nv">$title</span><span class="p">,</span>
                        <span class="s1">&#39;dateCreated&#39;</span> <span class="o">=&gt;</span> <span class="nx">get_post_time</span><span class="p">(</span><span class="s1">&#39;Y-m-d\TH:m:s\Z&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">),</span> <span class="c1">//!? 没有作用</span>
                        <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="nv">$content</span><span class="p">);</span>

    <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">$usr</span><span class="p">,</span> <span class="nv">$pwd</span><span class="p">,</span> <span class="nv">$sina_post</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

    <span class="nv">$sina_xmlrpc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">IXR_Client</span><span class="p">(</span><span class="nx">SINA_XMLRPC</span><span class="p">);</span>
    <span class="nv">$sina_xmlrpc</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;metaWeblog.newPost&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">);</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$sina_xmlrpc</span><span class="o">-&gt;</span><span class="na">getResponse</span><span class="p">();</span>

    <span class="nb">unset</span><span class="p">(</span><span class="nv">$sina_xmlrpc</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$res</span><span class="p">[</span><span class="s1">&#39;faultCode&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="s1">&#39;&lt;span style=&quot;color:red;&quot;&gt;导出失败&lt;/span&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">echo</span> <span class="nv">$title</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;=&gt; &#39;</span> <span class="o">.</span> <span class="nv">$res</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&lt;br /&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</code></pre></div>

<p><span class="btn-single btn-center"><a href="https://gist.github.com/4518491" class="btn btn-large icon-github">Source on gist</a></span></p>

<!-- content end -->
    </div><!-- .entry-content -->
    <div class="entry-meta">
        <ul>
            <li class="entry-author">Posted by JinnLynn</li>
            <li class="entry-categories"> in 
        <a href="http://jeeker.net/category/developer/" title="View all posts in Developer" rel="category tag">Developer</a>
</li>
            <li class="entry-human-time-diff"> on Jan 13, 2013</li>
            <li class="entry-comments"> with <a href="http://jeeker.net/article/export-wordpress-to-sina-blog/#comments" title="Comment on 导出Wordpress日志到新浪博客">Comments</a></li> 
        </ul>
    </div><!-- .entry-meta -->
</div><!-- #post-45453 -->


    <div id="pagenavi">
        <span class="pages">Page 1 of 1</span>
    </div><!-- #pagenavi -->
   
    </div><!-- #content -->
</div><!-- #container -->

<div id="sidebar">
</div><!-- #sidebar -->

</div><!-- #main -->

<div id="footer">
    <div id="footer-left">
        2012 Powered By <a href="http://jeeker.net/projects/gude/" title="a simple python static website generator">Gude</a>. Code licensed under <a href="http://opensource.org/licenses/MIT">MIT License</a>,
        articles licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.
    </div><!-- #footer-left -->
    <div id="footer-right">
    </div><!-- #footer-right -->
</div><!-- #footer -->

</div><!-- #wrapper -->

<!-- print javascript -->
<script type="text/javascript" src="http://jeeker.net/assets/script/action.js?90737"></script>
<!--[if lt IE 9]>
<script type='text/javascript' src='http://jeeker.net/assets/script/css3-mediaqueries.js?90737'></script>
<![endif]-->

<script type="text/javascript" src="http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=1635756822" charset="utf-8"></script>
<script type="text/javascript" src="/assets/additional.js"></script>

<!-- google analytics track code -->
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-31118267-1']);
    _gaq.push(['_trackPageview']);

    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

</body>
</html>